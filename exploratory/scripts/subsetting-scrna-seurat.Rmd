---
title: "Single Cell"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(Seurat)
```

##load data from the paper: https://www.nature.com/articles/s41597-023-02074-6
```{r}
scrna <- readRDS("/fs/ess/PAS1695/projects/atbac/data/scRNA/refquery_final.rds")
```

##get data from seurat
```{r} 
counts <- as.matrix(GetAssayData(object = scrna, slot = "counts")) %>%
  t() %>%
  as.data.frame()

cell.type <- FetchData(object = scrna, vars = "Cell_Cluster_level2") %>%
  as.data.frame() %>%
  rename("Cell Type" = "Cell_Cluster_level2")

umap <- as.data.frame(Embeddings(object = scrna, reduction = "umap")) 
```

##bind data frames into one
```{r}
scrna.subset <- cbind(counts, cell.type, umap) %>%
  rownames_to_column(var = "Sample")
```

##make R object of subsetted data
```{r}
saveRDS(scrna.subset, file = "/fs/ess/PAS1695/projects/atbac/data/scRNA/scrna-seurat-subset.RDS")
```

